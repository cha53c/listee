<!DOCTYPE html>
<html lang="en">
<%- include('list/head') %>
<body>
<div class="container-fluid bg-warning">
    <h1><%= heading %>
        <i class="material-icons md-36 update-page" onclick="window.location.href = '/lists/<%= userId %>/create';">add_circle</i>
        <%- include('list/editSaveButtons', { editAction: 'editLists()', saveAction: 'saveLists()', cancelAction: 'cancelAction()' }) %>
    </h1>

</div>
<div class="container bg-light">
    <h2 id="list-count"><%= listCount %></h2>
    <%- include('list/listItems', { items: listnames, addButton: false, withLinks: true }) %>
    <script src="/static/listFunctions.js"></script>
    <%- include('bootstrapScripts') %>
</div>
</body>

<script>
    function editLists() {
        toggle_edit_save();
        toggle_remove_undo();
    }

    function saveLists() {
        console.log('you clicked save lists');
        const xhr = new XMLHttpRequest();
        // send the updated list
        xhr.open("PATCH", '/lists/<%= userId %>', true);
        xhr.setRequestHeader('Content-Type', 'application/json');

        let deletedListNames = getDeletedItems();
        let list = {listnames: deletedListNames};
        console.log(JSON.stringify(list));
        xhr.send(JSON.stringify(list));

        xhr.onload = saveOnloadAction(xhr);

        xhr.onerror = function () {
            console.log('there was an error saving changes');
        }
    }

    window.onload = function () {
        const observer = new MutationObserver(setListCount);
        observer.observe(document.getElementById('list-items'), {attributes: false, childList: true, subtree: false});
    }

    function setListCount() {
        const count = document.getElementsByClassName('list-row').length;
        const grammar = count == 1 ? "list" : "lists";
        document.getElementById("list-count").innerHTML = "You have " + count + " " + grammar;
    }
</script>
</html>